<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diablo II: Lord of Destruction - Realm Hub (PVPGN/D2GS Status)</title>
    
    <style>
        /* d2console.css */
        :root {
            --color-background: #0f1113; 
            --color-text-main: #e6eef6; 
            --color-text-accent: #ffcc00; 
            --color-link: #00baff; 
            --color-border: #444444; 
            --color-card-bg: #1b1b1b; 
        }
        body {
            font-family: 'Garamond', 'Times New Roman', serif; 
            background: var(--color-background);
            color: var(--color-text-main);
            padding: 18px;
            margin: 0;
        }
        h1, h2, h3 {
            color: var(--color-text-accent);
            text-shadow: 1px 1px 2px #000;
        }
        a {
            color: var(--color-link);
            text-decoration: none;
        }
        a:hover {
            color: #4697ff;
        }
        .details-card {
            background: var(--color-card-bg);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }
        .details-card h3 {
            color: var(--color-link);
            border-bottom: 1px solid #333;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid var(--color-border);
            padding: 8px;
            vertical-align: top;
            background: var(--color-card-bg);
        }
        th {
            background: #161616;
            color: var(--color-text-accent);
            cursor: pointer;
        }
        tr:nth-child(even) td { background: #1a1a1a; }
        tr:hover td { background: #333; }
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px dotted #333;
        }
        .stat-item span:first-child {
            font-weight: normal;
            color: #a0a0a0;
        }
        .stat-item span:last-child {
            font-weight: bold;
            color: var(--color-text-accent); 
        }
        .unique, .type-unique { color: #ff9900; } 
        .set, .type-set { color: #00ff00; } 
        .rare, .type-rare { color: #ffff00; } 
        .magic, .type-magic { color: #4697ff; } 
        .rune, .type-rune { color: #00baff; } 
        .other, .type-other { color: #e6eef6; } 
        .item-properties-list {
            list-style: none; 
            padding-left: 10px; 
            margin-top: 5px;
            font-size: 0.9em;
        }
        .item-properties-list li {
            padding: 1px 0;
            color: #77ff77; 
        }
        .item-properties-list li:hover {
            background-color: #333;
        }

        /* d2lod.css */
        :root {
            --d2-bg: #0f1113;        
            --d2-primary: #e6eef6;    
            --d2-accent: #ffcc00;     
            --d2-link: #00baff;       
            --d2-border: #444444;     
            --d2-card-bg: #1b1b1b;    
            --d2-purple: #800080;     
            --d2-success: #00ff00;    
            --d2-error: #ff5722;      
        }
        .d2-h1 { 
            color: var(--d2-accent);
            border-bottom: 2px solid var(--d2-border);
            padding-bottom: 10px;
            text-shadow: 1px 1px 2px #000;
        }
        .sub {
            color: #a0a0a0;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        .links a, .players-table a {
            color: var(--d2-link);
            text-decoration: none;
        }
        .links a:hover, .players-table a:hover {
            color: #4697ff;
            text-decoration: underline;
        }
        .d2gs-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            margin-bottom: 40px;
        }
        .d2gs-stats .card {
            background: #1b0f1b; 
            border: 1px solid var(--d2-purple);
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 0 8px rgba(128, 0, 128, 0.4);
            text-align: center;
            min-width: 150px;
            flex-grow: 1;
        }
        .d2gs-stats .card h2 {
            margin: 0;
            font-size: 0.9rem;
            color: var(--d2-accent);
            text-transform: uppercase;
        }
        .d2gs-stats .card p {
            margin: 5px 0 0 0;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--d2-primary);
        }
        /* –¶–≤–µ—Ç–æ–≤–µ –∑–∞ —Å—Ç–∞—Ç—É—Å (CONNECTED/DISCONNECTED) */
        .status-connected { color: var(--d2-success); }
        .status-disconnected { color: var(--d2-error); }

        .game-card {
            background: var(--d2-card-bg);
            border: 2px solid var(--d2-border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .game-card.normal { border-color: green; }
        .game-card.nightmare { border-color: orange; }
        .game-card.hell { border-color: red; }
        .game-title {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--d2-accent);
            margin-bottom: 8px;
        }
        .xp-container {
            margin: 10px 0;
            padding: 5px 0;
            border-top: 1px dashed #333;
            border-bottom: 1px dashed #333;
        }
        .xp-bar-wrapper {
            background: #000;
            border: 1px solid #444;
            border-radius: 4px;
            overflow: hidden;
            height: 12px;
            margin-bottom: 5px;
        }
        .xp-bar {
            height: 100%;
            transition: width 0.5s;
        }
        .xp-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #a0a0a0;
        }
        .xp-multiplier {
            color: var(--d2-success);
        }
        .players-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.95em;
        }
        .players-table th, .players-table td {
            border: 1px solid #333;
            padding: 6px 8px;
            text-align: left;
        }
        .players-table th {
            background: #250a25; 
            color: var(--d2-accent);
        }
        .players-table tr:nth-child(even) td { background: #202020; }
        .players-table tr:hover td { background: #333; }
        .no-games-message, .error-message {
            color: var(--d2-error);
            text-align: center;
            padding: 20px;
            border: 1px dashed var(--d2-error);
            border-radius: 5px;
            margin-top: 30px;
        }
        .detail-stats .card {
            background: #201020; 
            border: 1px dashed var(--d2-purple);
            min-width: 250px;
            box-shadow: none;
        }
        .detail-stats .card p {
            font-size: 1rem;
            color: #00ff00; 
        }
        .pvpgn-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            margin-bottom: 40px;
        }
        .pvpgn-stats .card {
            background: #1b1b1b;
            border: 1px solid #6b4d21; 
        }
    </style>
</head>
<body>

<div class="header">
    <div class="logo">PVPGN Stats</div>
    <nav class="nav-tabs">
        <a href="#" class="tab">STATUS</a>
        <a href="#" class="tab d2xp-link active">D2 LOD</a>
        <a href="#" class="tab sexp-link">SC BW</a>
        <a href="#" class="tab w3xp-link">W3 TFT</a>
    </nav>
</div>

<div class="container">
    <h1 class="d2-h1">üî• Diablo II: Lord of Destruction Realm Hub</h1>
    <p class="sub">–ü–æ—Å–ª–µ–¥–Ω–æ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –æ—Ç —Ñ–∞–π–ª: <span id="last-updated">N/A</span></p>

    <div class="links" style="text-align: center; margin-bottom: 20px;">
        <a href="charitems.html" target="_blank" class="d2-link">üíé Item Stats</a> |
        <a href="runes.html" target="_blank" class="d2-link">‚öîÔ∏è Runes Inventoryr</a> |
        <a href="ladder.html" target="_blank" class="d2-link">ü•á Heros Ladder</a> |
        <a href="webladder.html" target="_blank" class="d2-link">‚öîÔ∏è Game Ladder</a>
    </div>

    <section>
        <h2 style="color: #ffcc00; margin-top: 30px;">PvPGN & System –°—Ç–∞—Ç—É—Å</h2>
        <div class="pvpgn-stats">
            <div class="card"><h2>Server Uptime (OS)</h2><p id="pvpgn-server-uptime">N/A</p></div>
            <div class="card"><h2>PvPGN Uptime</h2><p id="pvpgn-proc-uptime">N/A</p></div>
            <div class="card"><h2>Users Online (PvPGN)</h2><p id="pvpgn-users-online">N/A</p></div>
            <div class="card"><h2>Games Online (PvPGN)</h2><p id="pvpgn-games-online">N/A</p></div>
            <div class="card"><h2>Load Average (1m/5m/15m)</h2><p id="pvpgn-load-average">N/A</p></div>
            <div class="card"><h2>System Memory (Used/Total)</h2><p id="pvpgn-memory">N/A</p></div>
        </div>
    </section>

    <section>
        <h3 style="color: #ffcc00; margin-top: 40px;">–ê–∫—Ç–∏–≤–Ω–∏ –ò–≥—Ä–∏ –≤ –ú–æ–º–µ–Ω—Ç–∞ (D2GS)</h3>
        <div id="d2-games-container">
            <p class="no-games-message">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏ –æ—Ç d2gs_server_status.json...</p>
        </div>
    </section>


    <section>
        <h2 style="color: #ffcc00;">Realm Server (D2GS) –°—Ç–∞—Ç—É—Å</h2>
        <div class="d2gs-stats" id="d2gs-server-stats">
            <div class="card"><h2>Start Time</h2><p id="d2gs-uptime-value">N/A</p></div>
            <div class="card"><h2>Running Games</h2><p id="d2gs-running-games">N/A</p></div>
            <div class="card"><h2>Users In Game</h2><p id="d2gs-users-in-game">N/A</p></div>
            <div class="card"><h2>Max Prefer Users</h2><p id="d2gs-max-prefer-users">N/A</p></div>
            <div class="card"><h2>D2CS Connection</h2><p id="d2gs-d2cs">N/A</p></div>
            <div class="card"><h2>D2DBS Connection</h2><p id="d2gs-d2dbs">N/A</p></div>
        </div>
    </section>

    <section>
        <h2 style="color: #ffcc00; margin-top: 30px;">‚öôÔ∏è –ü–æ–¥—Ä–æ–±–Ω–∏ –†–µ—Å—É—Ä—Å–∏ –∏ –¢—Ä–∞—Ñ–∏–∫ (D2GS)</h2>
        <div class="d2gs-stats detail-stats">
            <div class="card"><h2>Kernel CPU Usage</h2><p id="d2gs-kernel-cpu">N/A</p></div>
            <div class="card"><h2>User CPU Usage</h2><p id="d2gs-user-cpu">N/A</p></div>
            <div class="card"><h2>Physical Memory (Used/Total)</h2><p id="d2gs-phys-memory">N/A</p></div>
            <div class="card"><h2>Virtual Memory (Used/Total)</h2><p id="d2gs-virt-memory">N/A</p></div>
            <div class="card"><h2>D2CS Peak Rate</h2><p id="d2gs-d2cs-peak-rate">N/A</p></div>
            <div class="card"><h2>D2DBS Peak Rate</h2><p id="d2gs-d2dbs-peak-rate">N/A</p></div>
        </div>
    </section>


</div>

<footer class="footer">
    –ü–æ—Å–ª–µ–¥–Ω–æ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –æ—Ç —Ñ–∞–π–ª: <span id="last-updated-footer">N/A</span>
</footer>

<script>
    // --- –ü—ä—Ç–∏—â–∞ –¥–æ –≤–∞—à–∏—Ç–µ JSON —Ñ–∞–π–ª–æ–≤–µ ---
    const PVPGN_JSON_URL = 'pvpgn_server_status.json';
    const D2GS_JSON_URL = 'd2gs_server_status.json';
    
    // --- Helper Functions ---
    
    function formatLargeSeconds(totalSeconds) {
        if (!totalSeconds || isNaN(totalSeconds) || totalSeconds <= 0) {
            return "N/A";
        }
        totalSeconds = Number(totalSeconds);
        const years = Math.floor(totalSeconds / (3600 * 24 * 365));
        const days = Math.floor((totalSeconds % (3600 * 24 * 365)) / (3600 * 24));
        const hours = Math.floor((totalSeconds % (3600 * 24)) / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);

        let parts = [];
        if (years > 0) parts.push(`${years}y`);
        if (days > 0) parts.push(`${days}d`);
        if (hours > 0) parts.push(`${hours}h`);
        if (minutes > 0 && years === 0) parts.push(`${minutes}m`); 

        return parts.length > 0 ? parts.join(' ') : 'Under 1 min';
    }

    function calculateXPMultiplier(players) {
        const N = Math.min(8, Math.max(1, players));
        const multiplier = (N + 1) / 2;
        const bonus = ((multiplier - 1) * 100).toFixed(0) + '%';
        return { multiplier: multiplier.toFixed(2), bonus: bonus, maxPlayers: 8 };
    }

    function translateClass(shortName) {
        const map = {
            'AMA': 'Amazon', 'BAR': 'Barbarian', 'NEC': 'Necromancer', 
            'PALADIN': 'Paladin', 'SORCERESS': 'Sorceress', 'DRU': 'Druid', 
            'AS': 'Assassin', 'ASS': 'Assassin', 'BAR': 'Barbarian',
            'Ama': 'Amazon', 'Sorceress': 'Sorceress', 'Bar': 'Barbarian', 
            'Paladin': 'Paladin'
        };
        const cleanName = shortName.toUpperCase().trim().replace(/\s/g, ''); 
        return map[cleanName] || shortName; 
    }

    const COLOR_PALETTE = [
        '#607d8b', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', 
        '#ff9800', '#ff5722', '#e64a19', '#b71c1c',
    ];

    // --- –§—É–Ω–∫—Ü–∏–∏ –∑–∞ –ø–æ–ø—ä–ª–≤–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏ ---

    async function fetchData(url) {
        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return await response.json();
        } catch (error) {
            console.error(`–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —á–µ—Ç–µ–Ω–µ –Ω–∞ —Ñ–∞–π–ª ${url}:`, error);
            return null;
        }
    }


    async function populatePvPGNStats() {
        const data = await fetchData(PVPGN_JSON_URL);
        
        if (!data) {
            document.getElementById('pvpgn-server-uptime').textContent = '–ì—Ä–µ—à–∫–∞ (OS)';
            return;
        }
        
        // –û–±—â–æ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –¥–∞—Ç–∞—Ç–∞ –æ—Ç —Ñ–∞–π–ª–∞
        document.getElementById('last-updated').textContent = data.timestamp;
        document.getElementById('last-updated-footer').textContent = data.timestamp;

        // PvPGN & System Stats
        document.getElementById('pvpgn-server-uptime').textContent = formatLargeSeconds(data.server.uptime_seconds) || 'N/A';
        document.getElementById('pvpgn-proc-uptime').textContent = formatLargeSeconds(data.pvpgn.uptime) || 'N/A';
        document.getElementById('pvpgn-users-online').textContent = data.pvpgn.users_online || 0;
        document.getElementById('pvpgn-games-online').textContent = data.pvpgn.games_online || 0;
        document.getElementById('pvpgn-load-average').textContent = `${data.server.load_average['1m']} / ${data.server.load_average['5m']} / ${data.server.load_average['15m']}`;
        document.getElementById('pvpgn-memory').textContent = `${data.server.used_mb} MB / ${data.server.total_mb} MB (Avail: ${data.server.available_mb} MB)`;
    }


    async function populateD2GSStats() {
        const statusData = await fetchData(D2GS_JSON_URL);

        if (!statusData) {
            document.getElementById('d2gs-uptime-value').textContent = '–ì—Ä–µ—à–∫–∞ (D2GS)';
            return;
        }

        // –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –¥–∞—Ç–∞—Ç–∞ –æ—Ç D2GS —Ñ–∞–π–ª–∞ (–∞–∫–æ –∏–º–∞ —Ä–∞–∑–ª–∏–∫–∞ —Å PvPGN)
        document.getElementById('last-updated').textContent = statusData.timestamp;
        document.getElementById('last-updated-footer').textContent = statusData.timestamp;

        // –û—Å–Ω–æ–≤–Ω–∏ –º–µ—Ç—Ä–∏–∫–∏
        document.getElementById('d2gs-uptime-value').textContent = statusData.start_time || 'N/A';
        document.getElementById('d2gs-running-games').textContent = statusData.server_status.current_running_games;
        document.getElementById('d2gs-users-in-game').textContent = statusData.server_status.current_users;
        document.getElementById('d2gs-max-prefer-users').textContent = statusData.server_status.max_prefer_users;
        
        // –í—Ä—ä–∑–∫–∏
        const d2csStatus = statusData.connections.D2CS.status.toUpperCase();
        const d2dbsStatus = statusData.connections.D2DBS.status.toUpperCase();
        document.getElementById('d2gs-d2cs').innerHTML = `<span class="status-${d2csStatus.toLowerCase()}">${d2csStatus}</span>`;
        document.getElementById('d2gs-d2dbs').innerHTML = `<span class="status-${d2dbsStatus.toLowerCase()}">${d2dbsStatus}</span>`;
        
        // –†–µ—Å—É—Ä—Å–∏
        const kernelCPU = (statusData.server_status.kernel_cpu_percent || 0.0).toFixed(2);
        const userCPU = (statusData.server_status.user_cpu_percent || 0.0).toFixed(2);
        const physUsed = (statusData.server_status.physical_mem_used_mb || 0.0).toFixed(2);
        const physTotal = (statusData.server_status.physical_mem_total_mb || 0.0).toFixed(2);
        const virtUsed = (statusData.server_status.virtual_mem_used_mb || 0.0).toFixed(2);
        const virtTotal = (statusData.server_status.virtual_mem_total_mb || 0.0).toFixed(2);

        document.getElementById('d2gs-kernel-cpu').textContent = `${kernelCPU} %`;
        document.getElementById('d2gs-user-cpu').textContent = `${userCPU} %`;
        document.getElementById('d2gs-phys-memory').textContent = `${physUsed} MB / ${physTotal} MB`;
        document.getElementById('d2gs-virt-memory').textContent = `${virtUsed} MB / ${virtTotal} MB`;

        // –ú—Ä–µ–∂–∞
        document.getElementById('d2gs-d2cs-peak-rate').textContent = `${(statusData.network.D2CS.peak_send_rate || 0).toFixed(3)} KB/s`;
        document.getElementById('d2gs-d2dbs-peak-rate').textContent = `${(statusData.network.D2DBS.peak_send_rate || 0).toFixed(3)} KB/s`;

        return statusData; // –í—Ä—ä—â–∞–º–µ –¥–∞–Ω–Ω–∏—Ç–µ –∑–∞ loadD2Games
    }


    function loadD2Games(statusData) {
        const games = statusData.games;
        const charactersMap = statusData.characters;
        const container = document.getElementById('d2-games-container');
        container.innerHTML = ''; 

        if (!games || games.length === 0) {
            container.innerHTML = '<p class="no-games-message">–í –º–æ–º–µ–Ω—Ç–∞ –Ω—è–º–∞ –∞–∫—Ç–∏–≤–Ω–∏ Diablo II –∏–≥—Ä–∏.</p>';
            return;
        }

        games.forEach(game => {
          const gameId = game.game_id;
          const userCount = game.users;
          const maxPlayers = 8;
          
          const { multiplier, bonus: xpBonus } = calculateXPMultiplier(userCount);
          
          const barWidth = (userCount / maxPlayers) * 100; 
          const hexColor = COLOR_PALETTE[userCount] || COLOR_PALETTE[0]; 
          const dynamicColorStyle = `background: linear-gradient(90deg, #1f4f1f, ${hexColor});`;
          
          const div = document.createElement('div');
          let diff = (game.difficulty || 'normal').toLowerCase(); 
          if(diff !== 'normal' && diff !== 'nightmare' && diff !== 'hell') diff = 'normal';
          div.className = 'game-card ' + diff;
          
          
          let htmlContent = `<div class="game-title">${game.game_name} (${game.difficulty.toUpperCase()}) - ${userCount}/${maxPlayers} player(s)</div>`; 

          htmlContent += `
              <div class="xp-container">
                  <div class="xp-bar-wrapper">
                      <div class="xp-bar" style="width: ${barWidth}%; ${dynamicColorStyle}"></div>
                  </div>
                  <div class="xp-text">
                      <span>XP Potential: Players ${userCount}</span>
                      <span class="xp-multiplier">XP Multiplier: +${xpBonus}</span>
                  </div>
              </div>
          `;

          const characters = charactersMap[gameId.toString()] || [];
          if(characters.length > 0){
            let table = `<table class="players-table"><tr><th>Name</th><th>Class</th><th>Level</th><th>Enter Time</th></tr>`;
            characters.forEach(ch => {
                const className = translateClass(ch.class); 
                table += `<tr>
                  <td>${ch.char_name}</td> 
                  <td>${className}</td> 
                  <td>${ch.level}</td> 
                  <td>${ch.enter_time}</td> 
                </tr>`;
            });
            table += '</table>';
            htmlContent += table;
          }
          
          div.innerHTML = htmlContent;
          container.appendChild(div);
        });
        
    }


    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
    async function init() {
        // –ü–æ–ø—ä–ª–≤–∞–º–µ PvPGN –¥–∞–Ω–Ω–∏—Ç–µ
        await populatePvPGNStats();

        // –ü–æ–ø—ä–ª–≤–∞–º–µ D2GS –¥–∞–Ω–Ω–∏—Ç–µ –∏ –∏–≥—Ä–∏—Ç–µ
        const d2gsData = await populateD2GSStats();
        if (d2gsData) {
            loadD2Games(d2gsData);
        }
    }

    document.addEventListener('DOMContentLoaded', init);

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –≤—Å–µ–∫–∏ 60 —Å–µ–∫—É–Ω–¥–∏ (–∞–∫–æ —Ñ–∞–π–ª–æ–≤–µ—Ç–µ —Å–µ –æ–±–Ω–æ–≤—è–≤–∞—Ç –Ω–∞ —Å—ä—Ä–≤—ä—Ä–∞)
    setInterval(init, 60000); 

</script>
</body>
</html>
